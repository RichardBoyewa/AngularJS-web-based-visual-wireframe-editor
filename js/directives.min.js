!function(){"use strict"}(),angular.module("gui.directives",["gui.filters"]).directive("keyIncrement",[function(){return function(e,t){t.on("keydown",function(e){var n=e.keyCode,o=function(e){var n=t.val(),o=parseInt(n.replace(/[^-\d\.]/g,"")),i=o+e,a=n.replace(o,"");t.val(i+(""===a?"px":a)).triggerHandler("input")};40==n?o(-1):38==n&&o(1)})}}]).directive("toolbox",["$compile","launcherFilter",function(e){return{compile:function(){return function(t,n,o){var i=e("<button ng-repeat=\"(key,value) in data.tools | launcher:'"+o.toolbox+'\'" type="button" class="btn" ng-class="{active: value.isActive}" set-tool="{{value.id}}" title="{{value.label}}" ng-attr-is-default="{{value.isDefault}}"><span class="{{value.iconClass}}"></span></button>')(t);n.append(i)}}}}]).directive("setTool",["$compile",function(e){return{link:function(t,n,o){t.data.fn.setTool(t,n,o,e)}}}]).directive("toolActions",["$compile",function(e){return{compile:function(){return function(t,n){t.$watch("data.toolActions.actions",function(){var o=e('<button type="button" class="btn btn-sm btn-default" ng-repeat="action in data.toolActions.actions" ng-click="action.fn()" title="{{action.name}}"><span class="{{action.iconClass}}"></span></button>')(t);n.empty().append(o)},!0)}}}}]).directive("trackMouseEvents",["$compile",function(e){return function(t,n){n.on("mousedown mouseup mouseenter mouseleave",function(n){n.preventDefault();var o=n.target,i=t.data.tools,a=$("#horizontalRuler"),c=$("#rulerHGuide"),r=$("#verticalRuler"),l=$("#rulerVGuide"),u=$("#rulers"),s={event:n,scope:t,compile:e};o==a||o==c?i.addGuide.horizontal[n.type](s):o==r||o==l?i.addGuide.vertical[n.type](s):o==u||(i.addGuide.isActive?i.addGuide[i.addGuide.isActive][n.type](s):("function"==typeof i[t.data.tool].setUndo&&i[t.data.tool].setUndo(s),"function"==typeof i[t.data.tool][n.type]&&i[t.data.tool][n.type](s)))})}}]).directive("trackMousePosition",[function(){return function(e,t){t.on("mousemove",function(t){var n=$("#screen").offset();e.$apply(function(){e.data.mouse.y=t.pageX,e.data.mouse.x=t.pageY,e.data.screen.mouse.x=t.pageX-n.left,e.data.screen.mouse.y=t.pageY-n.top}),e.data.tools[e.data.tool].mousemove(t,e)})}}]).directive("modal",[function(){return{transclude:!0,templateUrl:"templates/modal.html",scope:{},link:function(e,t){e.content="Hello modals",t.on("click",function(e){e.target==t[0]&&t.remove()})}}}]).directive("showElements",function(e){return{scope:{family:"="},templateUrl:"templates/tree.html",compile:function(t){return e.compile(t)}}}).directive("tree",function(){return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,compile:function(e,t,n){var o,i,a,c,r;return o=t.tree.match(/^(.*) in ((?:.*\.)?(.*)) at (.*)$/),i=o[1],a=o[2],c=o[3],r=o[4],function(e,t){function o(e){for(var t=u.length;t--;)if(u[t].scope[i]===e)return u.splice(t,1)[0]}var l=t[0].parentNode,u=[];e.$watch(a,function(t){var a=[],s=function(e,t,l,d){for(var p,f,m,v,y,k=0,h=e.length,$=h-1;h>k;++k)p=t.childNodes[k],f=e[k],m=o(f),m&&m.parentScope!==l&&(u.push(m),m=null),m?m.element!==p&&t.insertBefore(m.element,p):n(l.$new(),function(e,n){n[i]=f,m={scope:n,parentScope:l,element:e[0],branch:"none"==r?e[0]:e.find(r)[0]},t.insertBefore(m.element,p)}),v=m.scope,v.$depth=d,v.$index=k,v.$first=0===k,v.$last=k===$,v.$middle=!(v.$first||v.$last),a.push(m),y=f[c],y&&y.length&&s(y,m.branch,v,d+1)};s(t,l,e,0);for(var d=u.length;d--;){var p=u[d];p.scope&&p.scope.$destroy(),p.element&&p.element.parentNode.removeChild(p.element)}u=a},!0)}}}}).directive("colorPicker",["$compile","$parse",function(e,t){return{compile:function(){return function(n,o,i){var a=e('<div class="tr-sq"><input type="text" class="swatch" style="background-color:'+t(i.model)(n)+'" ng-model="'+i.model+'" colorpicker="rgba"  colorpicker-position="value" colorpicker-position-value="0,40" colorpicker-parent colorpicker-with-input="true" /></div>')(n);o.append(a),n.$watch(i.model,function(e){a.children().css("background-color",e),"layer"==n.data.selection.active.type?n.data.drawStyle[i.which]=e:(console.log(n.data.selection),n.data.selection.active.style[i.which]=e)})}}}}]).directive("listenKeystrokes",["$compile",function(e){return function(t){$(window).on("keydown keyup",function(n){console.log(n),"undefined"!=typeof t.data.keystrokes[n.keyCode]&&"undefined"!=typeof t.data.keystrokes[n.keyCode][n.type]&&t.data.keystrokes[n.keyCode][n.type]({e:n,s:t,c:e})})}}]);