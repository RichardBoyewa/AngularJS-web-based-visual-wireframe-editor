config.tools={addGuide:{id:"addGuide",isDefault:!1,isActive:!1,launcher:"menu_view",horizontal:{mousedown:function(e){e.scope.data.tools.addGuide.isActive="horizontal",console.log("hor md")},mouseup:function(e){console.log("hor mu");var t=e.scope.data;t.tools.addGuide.isActive=!1}},vertical:{mousedown:function(e){e.scope.data.tools.addGuide.isActive="vertical",console.log("ver md")},mouseup:function(e){e.scope.data.tools.addGuide.isActive=!1,console.log("ver mu")}}},drawArea:{cursor:"crosshair",id:"drawArea",isDefault:!1,isActive:!1,launcher:"none",label:"Draw Area",iconClass:"ci select",isMoving:!1,optionsTemplate:'<div id="drawAreaOptions" class="options-panel form-inline"><div class="form-group"><label for="drawAreaTop">Top</label><input class="form-control" type="text" aria-describedby="drawAreaTop" ng-model="data.tools.drawArea.config.areaStyle.top" x-key-increment /></div><div class="form-group"><label for="drawAreaHeight">Left</label><input class="form-control" type="text" aria-describedby="drawAreaLeft" ng-model="data.tools.drawArea.config.areaStyle.left" x-key-increment /></div><div class="form-group"><label for="drawAreaWidth">Width</label><input class="form-control" type="text" aria-describedby="drawAreaWidth" ng-model="data.tools.drawArea.config.areaStyle.width" x-key-increment /></div><div class="form-group"><label for="drawAreaHeight">Height</label><input class="form-control" type="text" aria-describedby="drawAreaHeight" ng-model="data.tools.drawArea.config.areaStyle.height" x-key-increment /></div></div>',element:null,baseConfig:{leftPx:0,topPx:0,areaClass:"draw-area",areaStyle:{left:"0",top:"0",width:"0",height:"0"}},config:null,init:function(e,t){t.data.tools.drawArea.config=$.extend({},config.tools.drawArea.baseConfig);var o=$("#canvas"),a='<div id="drawAreaBox" ng-class="data.tools.drawArea.config.areaClass" ng-style="data.tools.drawArea.config.areaStyle"></div>',l=e(a)(t);o.append(l),t.data.tools.drawArea.element=l,t.data.tools.drawArea.optionsMenu=sElem},destroy:function(e){e.data.tools.drawArea.config=$.extend({},config.tools.drawArea.baseConfig);var t=e.data.tools.drawArea;t.element&&(t.element.remove(),t.optionsMenu.remove())},setUndo:function(){},mousedown:function(e){e.scope.$apply(function(){var t=e.scope.data,o=t.tools.drawArea.config,a=e.event,l=$("#canvas");if(a.target==l[0])o.initPos={lPx:a.offsetX,tPx:a.offsetY},o.areaStyle={left:a.offsetX+"px",lPx:a.offsetX,top:a.offsetY+"px",tPx:a.offsetY,width:0,wPx:0,height:0,hPx:0};else if("workarea"==a.target.id){var r=l.offset(),n=a.pageX-r.left,s=a.pageY-r.top,i=t.screen.wPx,d=t.screen.hPx,f=n>0?n:0;f=Math.floor(f>i?i:f);var c=s>0?s:0;c=Math.floor(c>d?d:c),o.initPos={lPx:f,tPx:c},o.areaStyle={left:f+"px",lPx:f,top:c+"px",tPx:c,width:0,wPx:0,height:0,hPx:0}}else"drawAreaBox"==a.target.id&&(t.tools.drawArea.isMoving=!0)})},mouseup:function(e){e.scope.data.tools.drawArea.isMoving=!1,e.scope.data.tools.drawArea.finishSelect(e)},mouseleave:function(){},finishSelect:function(e){var t=(e.event,e.scope.data),o=t.tools.drawArea,a="mousedown"==t.flags.mouseEvent||"touchstart"==t.flags.mouseEvent?!0:!1;o.isMoving||a||(o.config.leftPx=o.config.areaStyle.lPx,o.config.topPx=o.config.areaStyle.tPx)},mouseenter:function(e){e.scope.data.tools.drawArea.finishSelect(e)},mousemove:function(e,t){var o=$("#canvas"),a="mousedown"==t.data.flags.mouseEvent||"touchstart"==t.data.flags.mouseEvent?!0:!1;a&&t.$apply(function(){var a=t.data,l=a.tools.drawArea.config;if(console.log(t.data.tools.drawArea.isMoving),t.data.tools.drawArea.isMoving){var r=l.areaStyle.lPx+e.originalEvent.movementX,n=l.areaStyle.tPx+e.originalEvent.movementY,s=a.screen.wPx,i=a.screen.hPx;r=r>=0?r:0,n=n>=0?n:0,r=r+l.areaStyle.wPx>s?l.areaStyle.lPx:r,n=n+l.areaStyle.hPx>i?l.areaStyle.tPx:n,l.areaStyle.lPx=r,l.areaStyle.left=r+"px",l.areaStyle.tPx=n,l.areaStyle.top=n+"px"}else{var d=o.offset(),f=e.pageX-d.left,c=e.pageY-d.top,x=a.screen.wPx,m=a.screen.hPx,u=f>0?f:0,p=c>0?c:0;u=Math.floor(u>x?x:u),p=Math.floor(p>m?m:p);var g=l.areaStyle.lPx<u?l.areaStyle.lPx:u,v=l.areaStyle.tPx<p?l.areaStyle.tPx:p,w=l.areaStyle.lPx<u?u-l.areaStyle.lPx:l.initPos.lPx-u,h=l.areaStyle.tPx<p?p-l.areaStyle.tPx:l.initPos.tPx-p;l.areaStyle={lPx:g,left:g+"px",tPx:v,top:v+"px",wPx:w,width:w+"px",hPx:h,height:h+"px"}}})}},crop:{isDefault:!1,isActive:!1,id:"crop",launcher:"menu_view",label:"Crop",iconClass:"fa fa-crop",init:function(){console.log("crop init")},destroy:function(){console.log("crop destroy")},mousedown:function(){},mouseup:function(){},mousemove:function(){}},drawBox:{cursor:"crosshair",id:"drawBox",isDefault:!0,isActive:!1,launcher:"toolbar",label:"Draw Box",iconClass:"fa fa-square-o",isMoving:!1,isDrawing:!1,optionsTemplate:"",element:null,config:null,resetConfig:function(e){e.data.tools.drawBox.config={areaClass:"draw-box",areaStyle:$.extend({left:"-10000px",top:"-10000px",width:"0",height:"0",lPx:-1e4,tPx:-1e4,wPx:0,hPx:0},e.data.drawStyle)}},init:function(e,t){t.data.tools.drawBox.resetConfig(t);var o='<div id="drawBoxBox" ng-class="data.tools.drawBox.config.areaClass" ng-style="data.tools.drawBox.config.areaStyle"></div>',a=e(o)(t),l=e(t.data.tools.drawBox.optionsTemplate)(t);$("#canvas").append(a),$("#toolOptions").append(l),t.data.tools.drawBox.element=a,t.data.tools.drawBox.optionsMenu=l},destroy:function(e){var t=e.data.tools.drawBox;t.resetConfig(e),t.element&&(t.element.remove(),t.optionsMenu.remove())},setUndo:function(){},mousedown:function(e){e.scope.data.tools.drawBox.clickTouch(e)},touchstart:function(e){e.scope.data.tools.drawBox.clickTouch(e)},clickTouch:function(e){e.scope.data.tools.drawBox.resetConfig(e.scope);var t=e.scope.data,o=t.tools.drawBox.config,a=e.event,l=$("#canvas");e.scope.$apply(function(){if(a.target==l[0])o.areaStyle.left=a.offsetX+"px",o.areaStyle.lPx=a.offsetX,o.areaStyle.top=a.offsetY+"px",o.areaStyle.tPx=a.offsetY,o.initPos={lPx:a.offsetX,tPx:a.offsetY},o.areaStyle.width=0,o.areaStyle.wPx=0,o.areaStyle.height=0,o.areaStyle.hPx=0,t.tools.drawBox.isDrawing=!0;else if("workarea"==a.target.id){var e=l.offset(),r=a.pageX-e.left,n=a.pageY-e.top,s=t.screen.wPx,i=t.screen.hPx,d=t.screen.overflow?r:r>0?r:0;d=Math.floor(d>s?s:d);var f=t.screen.overflow?n:n>0?n:0;f=Math.floor(f>i?i:f),o.areaStyle.left=d+"px",o.areaStyle.lPx=d,o.areaStyle.top=f+"px",o.areaStyle.tPx=f,o.initPos={lPx:d,tPx:f},o.areaStyle.width=0,o.areaStyle.wPx=0,o.areaStyle.height=0,o.areaStyle.hPx=0,t.tools.drawBox.isDrawing=!0}else"drawBoxBox"==a.target.id&&(t.tools.drawBox.isMoving=!0)})},mouseup:function(e){e.scope.data.tools.drawBox.isMoving=!1,e.scope.data.tools.drawBox.finishSelect(e)},touchend:function(e){e.scope.data.tools.drawBox.isMoving=!1,e.scope.data.tools.drawBox.finishSelect(e)},mouseleave:function(){},finishSelect:function(e){var t=(e.event,e.scope.data),o=t.tools.drawBox,a="mousedown"==t.flags.mouseEvent||"touchstart"==t.flags.mouseEvent?!0:!1;if(!o.isMoving&&!a&&o.isDrawing){if(o.config.areaStyle.wPx>0&&o.config.areaStyle.hPx>0){var l=e.scope.data.fn.tree.returnSelected(t.tree.root.children);t.config.allowNestedElements||(l="layer"==l.type?l:e.scope.data.fn.tree.selectParentLayer(e.scope.data.tree.root.children),e.scope.data.fn.tree.toggleSelected({child:l,data:e.scope.data})),console.log(o);var r=(l.styles.normal.tPx,l.styles.normal.lPx,o.config.areaStyle.tPx,o.config.areaStyle.lPx,t.fn.calculateOffset(t,l,o.config.areaStyle));l.children.push({id:t.fn.tree.newLayerName({pre:e.scope.data.lang[e.scope.data.lang.act].element,data:e.scope.data}),type:"element",cursorClass:"",typeNum:2,children:[],styles:{normal:$.extend({position:"absolute",left:r.left,lPx:r.lPx,top:r.top,tPx:r.tPx,width:o.config.areaStyle.width,wPx:o.config.areaStyle.wPx,height:o.config.areaStyle.height,hPx:o.config.areaStyle.hPx,overflow:"hidden","white-space":"pre-wrap"},t.drawStyle)}})}o.isDrawing=!1,o.resetConfig(e.scope)}},mouseenter:function(e){e.scope.data.tools.drawBox.finishSelect(e)},mousemove:function(e,t){t.data.tools.drawBox.move(e,t)},touchmove:function(e,t){t.data.tools.drawBox.move(e,t)},move:function(e,t){var o="mousedown"==t.data.flags.mouseEvent||"touchstart"==t.data.flags.mouseEvent?!0:!1;if(o){var a=$("#canvas"),l=t.data,r=l.tools.drawBox.config,n=a.offset(),s=e.pageX-n.left,i=e.pageY-n.top,d=l.screen.wPx,f=l.screen.hPx,c=l.screen.overflow?s:s>0?s:0,x=l.screen.overflow?i:i>0?i:0;c=Math.floor(l.screen.overflow?c:c>d?d:c),x=Math.floor(l.screen.overflow?x:x>f?f:x);var m=r.areaStyle.lPx<c?r.areaStyle.lPx:c,u=r.areaStyle.tPx<x?r.areaStyle.tPx:x,p=Math.floor(r.areaStyle.lPx<c?c-r.areaStyle.lPx:r.initPos.lPx-c),g=Math.floor(r.areaStyle.tPx<x?x-r.areaStyle.tPx:r.initPos.tPx-x);t.$apply(function(){r.areaStyle.lPx=m,r.areaStyle.left=m+"px",r.areaStyle.tPx=u,r.areaStyle.top=u+"px",r.areaStyle.wPx=p,r.areaStyle.width=p+"px",r.areaStyle.hPx=g,r.areaStyle.height=g+"px"})}}},selection:{cursor:"pointer",id:"selection",isDefault:!1,isActive:!1,launcher:"toolbar",label:"Select Element",iconClass:"fa fa-mouse-pointer",optionsTemplate:"",element:null,init:function(){$("#canvas,#guides").hide()},destroy:function(){$("#canvas,#guides").show(),$("#toolOptions").empty()},setUndo:function(){},down:function(e){var t=e.scope,o=e.event,a=(e.compile,t.data.tools.selection);if(a.element=t.data.fn.tree.searchElementById($(o.target).attr("ob-id"),t.data.tree.root.children),a.initPos={lPx:o.offsetX,tPx:o.offsetY},a.element)t.data.fn.tree.toggleSelected({child:a.element,data:t.data}),t.data.flags.resizeLeft=o.offsetX<5?!0:!1,t.data.flags.resizeTop=o.offsetY<5?!0:!1,t.data.flags.resizeRight=o.offsetX>a.element.styles.normal.wPx-5?!0:!1,t.data.flags.resizeBottom=o.offsetY>a.element.styles.normal.hPx-5?!0:!1;else{var l=t.data.fn.tree.selectParentLayer(t.data.tree.root.children);t.data.fn.tree.toggleSelected({child:l,data:t.data})}},mousedown:function(e){e.scope.data.tools.selection.down(e)},touchstart:function(e){e.scope.data.tools.selection.down(e)},mouseup:function(){},touchend:function(){},mouseleave:function(){},finishSelect:function(){},mouseenter:function(){},move:function(e,t){var o=t.data,a=o.flags,l=o.tools.selection.element,r="",n="mousedown"==o.flags.mouseEvent||"touchstart"==o.flags.mouseEvent?!0:!1;if(l&&2==l.typeNum&&(e.offsetY<5&&(r+="n"),e.offsetY>l.styles.normal.hPx-5&&(r+="s"),e.offsetX<5&&(r+="w"),e.offsetX>l.styles.normal.wPx-5&&(r+="e"),l.cursorClass=r),l&&2==l.typeNum&&n){console.log(e);var s=l.styles.normal.lPx,i=l.styles.normal.tPx;if(a.resizeLeft||a.resizeTop||a.resizeRight||a.resizeBottom){if(a.resizeLeft){var d=!o.screen.overflow&&e.originalEvent.movementX<0&&0===s?0:e.originalEvent.movementX;o.fn.modifiers.modifyElementArea(t,"left",d),o.fn.modifiers.modifyElementArea(t,"width",-1*d)}if(a.resizeTop){var f=!o.screen.overflow&&e.originalEvent.movementY<0&&0===i?0:e.originalEvent.movementY;o.fn.modifiers.modifyElementArea(t,"top",f),o.fn.modifiers.modifyElementArea(t,"height",-1*f)}a.resizeRight&&o.fn.modifiers.modifyElementArea(t,"width",e.originalEvent.movementX),a.resizeBottom&&o.fn.modifiers.modifyElementArea(t,"height",e.originalEvent.movementY)}else o.fn.modifiers.modifyElementArea(t,"left",e.originalEvent.movementX),o.fn.modifiers.modifyElementArea(t,"top",e.originalEvent.movementY)}},mousemove:function(e,t){t.data.tools.selection.move(e,t)},touchmove:function(e,t){t.data.tools.selection.move(e,t)}}};