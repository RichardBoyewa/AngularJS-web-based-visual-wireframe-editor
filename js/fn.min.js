$.pxNum=function(e){return 0!==e?parseInt(e.replace(/[^-\d\.]/g,"")):0},$.calculateOffset=function(e,t,n){var r=[],l=function(e,n){for(var i=0;i<e.length;i++){var o=e[i];if(o===t)return r[n]=o,!0;o.children.length&&(r[n]=o,l(o.children,n+1))}return!1};l(e.tree.root.children,0);var o=0,a=0;for(i=0;i<r.length;i++)o+=r[i].style.lPx+r[i].style.bwPx,a+=r[i].style.tPx+r[i].style.bwPx;var c=n.lPx,d=n.tPx,f=c-o,u=d-a;return{left:f+"px",lPx:f,top:u+"px",tPx:u}},config.fn={fireModal:function(e,t){var n=$("body"),r='<div class="modal-backdrop" modal>{{data.modal.content}}</div>',l=t(r)(e);n.append(l)},killModal:function(){angular.element(document.querySelector(".modal-backdrop")).remove()},setTool:function(e,t,n,r){t.on("click",function(){e.data.fn.initTool(e,n,r)}),"true"==n.isDefault&&e.data.fn.initTool(e,n,r)},initTool:function(e,t,n){var r=e.data.tools;r[e.data.tool].destroy(e),r[e.data.tool].isActive=!1,$("#canvas").removeClass(e.data.tool),e.data.tool=t.setTool,r[e.data.tool].init(n,e),r[e.data.tool].isActive=!0,$("#canvas").addClass(e.data.tool)},tree:{removeSelected:function(e,t){t.fn.tree.remove(t.fn.tree.returnSelected(e.children),t)},remove:function(e,t){function n(t){var r,l=t.children;if(l)for(r=l.length;r--;){if(l[r]===e)return l.splice(r,1);n(l[r])}}n(t.tree.root),t.fn.tree.toggleSelected({child:t.selection.prev?t.selection.prev:t.selection.next?t.selection.next:t.selection.parent?t.selection.parent:null,data:t})},returnSelected:function(e){var t=function(e){for(var n=0;n<e.length;n++){var r=e[n];if(r.selected===!0)return r;var l=t(r.children);if(r.children.length>0&&l)return l}return!1};return t(e)},addChild:function(e,t){e.children.push({id:t.fn.tree.newLayerName({pre:null,data:t}),children:[],selected:!1,style:{top:"0",tPx:0,left:"0",lPx:0,width:"0",wPx:0,height:"0",hPx:0,overflow:"visible","border-width":"0px",bwPx:0},type:"root"==e.type?"layer":"element"}),t.fn.tree.toggleSelected({child:e.children[e.children.length-1],data:t})},selectParentLayer:function(e){var t=null,n=function(e){for(var r=0;r<e.length;r++){var l=e[r];if("layer"==l.type&&(t=l),l.selected===!0)return t;if(l.children.length>0&&n(l.children))return t}return!1};return n(e)},searchElementById:function(e,t){var n=function(t){for(var r=0;r<t.length;r++){var l=t[r];if(l.id===e)return l;var i=n(l.children);if(l.children.length>0&&i)return i}return!1};return n(t)},toggleSelected:function(e){var t=e.child,n=e.data;t&&(n.fn.tree.unSelect(n),t.selected=!0,n.fn.tree.logSelection({child:t,data:n}))},logSelection:function(e){var t=(e.child,e.data),n=null,r=function(e){for(var t=0;t<e.length;t++){var l=e[t];if("layer"==l.type&&(n=l),l.selected===!0)return{active:l,next:t+1<e.length?e[t+1]:null,prev:t-1>-1?e[t-1]:null,parent:"layer"==l.type?null:n};if(l.children.length>0){var i=r(l.children);if(i)return i}}return!1};t.selection=r(t.tree.root.children)},unSelect:function(e){function t(e){var n,r=e.children;if(r)for(n=r.length;n--;){if(r[n].selected){r[n].selected=!1;break}t(r[n])}}t(e.tree.root)},toggleMinimized:function(e){e.minimized=!e.minimized},newLayerName:function(e){for(var t,n=e.data,r="undefined"!=typeof e.pre&&e.pre?e.pre:n.lang[n.lang.act].layer,l=1,i=function(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(r.id==e)return!0;if(r.children.length>0&&i(e,r.children))return!0}return!1};l;){if(t=r+"_"+l,!i(t,n.tree.root.children))return t;l++}}}};