angular.module("gui.controllers",[]).controller("main",["$scope","$compile",function(e){e.data=$.extend({},config),e.fn={toggleSidebar:function(){e.data.config.sidebarClass=""===e.data.config.sidebarClass?"collapsed":""},modal:function(){}},e.tree={json:"",newLayerName:function(t){var r,n=1,l=function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(n.id==e)return!0;if(n.children.length>0&&l(e,n.children))return!0}return!1};for("undefined"==typeof t&&(t=e.data.lang[e.data.lang.act].layer);n;){if(r=t+"_"+n,!l(r,e.data.tree.root.children))return r;n++}},getJson:function(){e.tree.json=angular.toJson(e.data.tree.root)},toggleMinimized:function(e){e.minimized=!e.minimized},unSelect:function(){function t(e){var r,n=e.children;if(n)for(r=n.length;r--;){if(n[r].selected){n[r].selected=!1;break}t(n[r])}}t(e.data.tree.root)},logSelection:function(t){var r=null,n=function(e){for(var l=0;l<e.length;l++){var o=e[l];if("layer"==o.type&&(r=o),o.selected===!0)return{active:t,next:l+1<e.length?e[l+1]:null,prev:l-1>-1?e[l-1]:null,parent:null};if(o.children.length>0){var a=n(o.children);return a&&(a.parent=r),a}}return!1};e.data.selection=n(e.data.tree.root.children),console.log(e.data.selection)},toggleSelected:function(t){t&&(e.tree.unSelect(),t.selected=!0,e.tree.logSelection(t),"layer"==t.type?(e.data.colorPickers.background=e.data.drawStyle["background-color"],e.data.colorPickers.border=e.data.drawStyle["border-color"]):(e.data.colorPickers.background=t.style["background-color"],e.data.colorPickers.border=t.style["border-color"]))},searchElementById:function(t){var r=function(e){for(var n=0;n<e.length;n++){var l=e[n];if(l.id===t)return l;var o=r(l.children);if(l.children.length>0&&o)return o}return!1};return r(e.data.tree.root.children)},selectParentLayer:function(){var t=null,r=function(e){for(var n=0;n<e.length;n++){var l=e[n];if("layer"==l.type&&(t=l),l.selected===!0)return t;if(l.children.length>0&&r(l.children))return t}return!1};return r(e.data.tree.root.children)},addChild:function(t){t.children.push({id:e.tree.newLayerName(),children:[],selected:!1,style:{top:"0",tPx:0,left:"0",lPx:0,width:"0",wPx:0,height:"0",hPx:0,overflow:"visible","border-width":"0",bwPx:0},type:"root"==t.type?"layer":"element"}),e.tree.toggleSelected(t.children[t.children.length-1])},returnSelected:function(e){var t=function(e){for(var r=0;r<e.length;r++){var n=e[r];if(n.selected===!0)return n;var l=t(n.children);if(n.children.length>0&&l)return l}return!1};return t(e)},remove:function(t){function r(e){var n,l=e.children;if(l)for(n=l.length;n--;){if(l[n]===t)return l.splice(n,1);r(l[n])}}r(e.data.tree.root),e.tree.toggleSelected(e.data.selection.prev?e.data.selection.prev:e.data.selection.next?e.data.selection.next:e.data.selection.parent?e.data.selection.parent:null)},removeSelected:function(t){e.tree.remove(e.tree.returnSelected(t.children))},properties:function(){e.modal.content="hi",e.modal.showModal=!0}},e.tree.toggleSelected(e.tree.searchElementById("layer_1")),e.modal={showModal:!1,toggleModal:function(){e.modal.showModal=!e.modal.showModal}}}]);